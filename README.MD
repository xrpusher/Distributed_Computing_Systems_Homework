**Описание проекта**

Это веб-приложение на FastAPI, которое принимает число через POST-запрос и возвращает его, увеличенное на единицу. Приложение обрабатывает две исключительные ситуации:

Исключение #1: Если число уже было отправлено ранее.

Исключение #2: Если число на единицу меньше уже обработанного числа.
Все обработанные числа сохраняются в базе данных PostgreSQL 17.

**Структура проекта**

main.py — основной файл приложения FastAPI.

app_server.py — содержит бизнес-логику приложения.

database.py — отвечает за взаимодействие с базой данных PostgreSQL.

requirements.txt — список зависимостей проекта.

.env — файл с переменными окружения (необходимо создать).

logs/app.log — файл логирования ошибок приложения.

Component_Diagram.png — диаграмма компонентов.

Sequence_Diagram.png — диаграмма последовательностей.

**Требования**

Python 3.10 или выше.

PostgreSQL 17.

uvicorn для запуска сервера.

**Установка и настройка**

1. Клонирование репозитория

```
git clone https://github.com/your_username/your_repository.git

cd your_repository
```


2. Создание виртуального окружения

`python3 -m venv venv`

3. Активация виртуального окружения

Для Unix/Linux/MacOS:

`source venv/bin/activate`

4. Установка зависимостей

`pip install -r requirements.txt`

5. Установка и настройка PostgreSQL 17
5.1. Установка PostgreSQL 17

Скачайте и установите PostgreSQL 17 с официального сайта.

5.2. Создание пользователя и базы данных

Запустите PostgreSQL сервер.

Подключитесь к PostgreSQL как суперпользователь postgres:

`psql -U postgres -h localhost -p 5434`

Создайте пользователя для приложения:

`**CREATE USER myuser WITH PASSWORD 'mypassword';**`

Создайте базу данных:


`CREATE DATABASE mydatabase OWNER myuser;`

Предоставьте привилегии пользователю:

`GRANT ALL PRIVILEGES ON DATABASE mydatabase TO myuser;`

Выйдите из psql:

`\q`

5.3. Настройка переменных окружения
Создайте файл .env в корневой директории проекта и добавьте следующие строки:


```
DB_NAME=mydatabase
DB_USER=myuser
DB_PASSWORD=mypassword
DB_HOST=localhost
DB_PORT=5434
```

Важно: Убедитесь, что файл .env добавлен в .gitignore, чтобы избежать попадания конфиденциальных данных в репозиторий, убедитесь в прарвильности других данных.

**Запуск приложения**
1. Запуск одного экземпляра приложения

`uvicorn main:app --host 0.0.0.0 --port 8000 --reload`
2. Запуск нескольких экземпляров приложения
3. 
Для тестирования нескольких экземпляров приложения можно запустить их на разных портах. Это полезно для проверки масштабируемости и взаимодействия с базой данных.

Шаги:

Создайте дополнительные файлы .env для каждого экземпляра (например, .env_app2):

```
DB_NAME=mydatabase
DB_USER=myuser
DB_PASSWORD=mypassword
DB_HOST=localhost
DB_PORT=5434
```
(Если используются одинаковые настройки базы данных, можно использовать тот же файл .env.)

Запустите каждый экземпляр на своем порту:

Экземпляр 1 (порт 8000):

`uvicorn main:app --host 0.0.0.0 --port 8000 --reload`

Экземпляр 2 (порт 8001):


`uvicorn main:app --host 0.0.0.0 --port 8001 --reload`
(Вы можете запускать любое количество экземпляров, просто указывая разные порты.)

Отправка тестовых запросов

1. Успешный запрос
Запрос:

```
curl -X POST "http://localhost:8000/process_number" \
     -H "Content-Type: application/json" \
     -d '{"number": 5}'
```
Ответ:

`{"result":6}`
2. Исключительная ситуация #1 (число уже поступало ранее)
Запрос:

```
curl -X POST "http://localhost:8000/process_number" \
     -H "Content-Type: application/json" \
     -d '{"number": 5}'
```
Ответ:

`{"detail":"Число уже поступало ранее."}`

3. Исключительная ситуация #2 (число на единицу меньше максимального обработанного числа)

Запрос:

```
curl -X POST "http://localhost:8000/process_number" \
     -H "Content-Type: application/json" \
     -d '{"number": 4}'
```

Ответ:

`{"detail":"Число на единицу меньше уже обработанного числа."}`

**Логирование**

Все ошибки приложения логируются в файл logs/app.log. Убедитесь, что директория logs существует и имеет правильные права доступа.

**Диаграммы**

Диаграммы компонентов и последовательностей находятся в файлах Component_Diagram.png и Sequence_Diagram.png.